<!DOCTYPE html>
<html>
    <head>
        <title>Chat</title>
    </head>

    <body>
        <h1>Chat</h1>
        <p>This is the chat for communicating between clients</p>
        <a href="./index.html">home page</a><br>
        <a href="./page2.html">page2 page</a><br>
        <a href="./signup.html">Sign Up!</a><br>
        <a href="./login.html">Log In!</a><br>
        <div id="user">logged to user: </div>
        <ul id="messages"></ul>
        <form id="form" action="">
            <input id="msgInput" autocomplete="off" />
            <input id="roomInput" autocomplete="off" />
            <button>Send</button>
        </form>
        <div id="holder"></div>
        <script src="/socket.io/socket.io.js"></script>
        <script>
        var socket = io();
        var userSocket = io("/user", {auth: {token: localStorage.getItem("key")}});

        var form = document.getElementById('form');
        var msgInputObj = document.getElementById('msgInput');
        var roomInputObj = document.getElementById('roomInput');

        //receiving and sending messages to clients
        userSocket.on('send message to chat page', message => {
                displayMessage(message);
        });
        socket.on('recv-msg', message => {
            displayMessage(message);
        })

        userSocket.emit('request-user-info');
        userSocket.on('user-info', (username, password) => {
            document.getElementById("user").textContent = "logged to user: " + username;
        });
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            if (msgInputObj.value) {
                if(roomInputObj.value ==""){
                    socket.emit('chat message', msgInputObj.value);
                    msgInputObj.value = '';
                }else{
                    socket.emit('room message', msgInputObj.value, roomInputObj.value);
                    msgInputObj.value = '';
                }
            }
        });
        function displayMessage(message){
            const div = document.createElement("div");
            div.textContent = message;
            document.getElementById("holder").append(div);
        }
        </script>
    </body>
</html>