<!DOCTYPE html>
<html>
    <head>
        <title>Log In</title>
    </head>

    <body>
        <p>Log In:</p>
        <a href="./index.html">home page</a>
        <ul id="login"></ul>
        <form id="loginform" action="">
            <label for="username">username: </label><br>
            <input id="usernameinput" autocomplete="off" /><br>
            <label for="password">password: </label><br>
            <input id="passwordinput" autocomplete="off" />
            <button>Send</button>
        </form>
        <h4>dont have an account?</h4>
        <a href="./signup.html">Sign Up!</a>
        <div id="holder"></div>
        <script src="/socket.io/socket.io.js"></script>
        <script>
            var socket = io();
            var userSocket = io("/user", {auth: {token: localStorage.getItem("key"), sessionKeyCode: sessionStorage.getItem("key")}});

            var loginform = document.getElementById('loginform');
            var username = document.getElementById('usernameinput');
            var password = document.getElementById('passwordinput');
            userSocket.on('user-valid', (valid) => {
                if(valid){
                    sessionStorage.setItem("username", username.value);
                    displayMessage("successfully logged into: " + username.value);
                }else{
                    displayMessage("username or password incorrect!");
                }
            });

            loginform.addEventListener('submit', function(e) {
                e.preventDefault();
                if (username.value && password.value) {
                    userSocket.emit('login', username.value, password.value);
                    displayMessage("key: " + localStorage.getItem("key"));
                    displayMessage("key: " + sessionStorage.getItem("key"));
                    //username.value = '';
                    //password.value = '';
                }
            });

            function displayMessage(message){
                const div = document.createElement("div");
                div.textContent = message;
                document.getElementById("holder").append(div);
            }
        </script>
    </body>
</html>